# pyLRp grammar
# for the shellfish language

# the next line comes directly from the future ...
# import SyntaxTree

%lexer

"(.|\s)*" %restart
\s+ %restart
self SELF
[a-zA-Z][a-zA-Z0-9]* SYM
[a-zA-Z][a-zA-Z0-9]*: KEY
\#([a-zA-Z][a-zA-Z0-9:]*|[\+\-\*\/\\@:,\.\|\&]+) SYMLIT
[\+\-\*\/\\@:,\.]+ BIN

# well the current grammar parser is not very nice, a pyLRp parser for pyLRp grammars,
# which uses only the current, limited command-set would solve the problem.
# probably such beauties will be possible in the self parsed, bootstrapped version:

# nearly full lex-capability
# \" %begin(COMMENT), %restart
# <COMMENT> \" %end, %restart
# <COMMENT> .* %restart

# \"\"\" %begin(MLSTRING), %restart
# <MLSTRING> .* %append, %restart
# <MLSTRING> \"\"\" %collect, %end, MLSTRING

%parser

doc:
   %empty
   doc statement

statement:
    exp
    "^" exp
    exp "." statement
    SYM ":=" exp "." statement

exp:
    SYM
    SYMLIT
    "(" exp ")"
    exp SYM
    exp BIN exp
    SYM key
    "[" optparams optlocals statement "]"

optparams:
    params "|"
    %empty

params:
    params ":" SYM "|"
    %empty

optlocals:
    %empty
    "|" locals "|" 

locals:
    %empty
    locals SYM

key:
    KEY exp key1

key1:
    key
    %empty

